<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheerfulGoat 任务提交系统</title>
</head>
<body>

    <h1>提交新任务</h1>

    <form id="task-form">
        <label for="title">任务标题:</label>  

        <input type="text" id="title" name="title" required>  
  


        <label for="description">任务描述:</label>  

        <textarea id="description" name="description" rows="4" cols="50"></textarea>  
  


        <label for="platform">电商平台:</label>  

        <select id="platform" name="platform" required>
            <option value="亚马逊">亚马逊</option>
            <option value="tiktok">TikTok</option>
            <option value="独立站">独立站</option>
            <option value="虾皮">虾皮</option>
            <option value="国内">国内</option>
            <option value="b端">B端</option>
            <option value="杂项">杂项</option>
        </select>  
  


        <input type="checkbox" id="is_urgent" name="is_urgent">
        <label for="is_urgent">是否紧急</label>  
  


        <button type="submit">提交任务</button>
    </form>

    <p id="message"></p>
<script>
    const backendUrl = 'https://cheerfulgoat-task-system.onrender.com';
    const taskForm = document.getElementById('task-form' );
    const messageElement = document.getElementById('message');

    taskForm.addEventListener('submit', function(event) {
        event.preventDefault();

        // --- 这是我们唯一的、关键的修改！ ---
        // 我们不再使用 FormData，而是直接从元素中获取值，确保格式正确
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const platform = document.getElementById('platform').value;
        // 对于复选框，我们明确地检查它是否被勾选，然后发送 true 或 false
        const is_urgent = document.getElementById('is_urgent').checked; 
        
        const taskData = {
            title: title,
            description: description,
            platform: platform,
            is_urgent: is_urgent
        };
        // --- 修改结束 ---

        messageElement.textContent = '正在提交，请稍候...';
        messageElement.style.color = 'blue';

        fetch(`${backendUrl}/tasks/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(taskData)
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                // 如果失败了，我们尝试读取后端的错误信息，这样更清晰
                return response.text().then(text => { 
                    throw new Error('提交失败: ' + text); 
                });
            }
        })
        .then(data => {
            messageElement.textContent = `任务 "${data.title}" 提交成功！任务ID是: ${data.id}`;
            messageElement.style.color = 'green';
            taskForm.reset();
        })
        .catch(error => {
            messageElement.textContent = error.message;
            messageElement.style.color = 'red';
        });
    });
</script>
</body>
</html>
